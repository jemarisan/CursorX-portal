# CursorX å®˜ç½‘æ›´æ–°éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆï¼š**
- appcast.xml æ–‡ä»¶å·²åˆ›å»º
- downloads/ ç›®å½•å·²åˆ›å»º
- æµ‹è¯•ç‰ˆæœ¬é…ç½®å·²æ·»åŠ 

â³ **å¾…å®Œæˆï¼š**
- ç”Ÿæˆç­¾åå¯†é’¥
- ä¸Šä¼ å®‰è£…åŒ…æ–‡ä»¶
- é…ç½®ç­¾å
- éƒ¨ç½²åˆ° GitHub Pages

## ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å®‰è£…åŒ…æ–‡ä»¶

#### 1.1 å¯¼å‡ºåº”ç”¨ä¸º .dmg æ–‡ä»¶

åœ¨ Xcode ä¸­ï¼š

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ Xcode Archive
1. Product â†’ Archive
2. ç­‰å¾…å½’æ¡£å®Œæˆ
3. ç‚¹å‡» "Distribute App"
4. é€‰æ‹© "Copy App"
5. ä¿å­˜åˆ°æœ¬åœ°

# æ–¹æ³•2ï¼šç›´æ¥åˆ›å»º DMGï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰
cd /Users/ymg/gitee/xcursor/xpoint
./create_dmg.sh  # ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„è„šæœ¬
```

#### 1.2 å°† .dmg æ–‡ä»¶å¤åˆ¶åˆ° downloads ç›®å½•

```bash
# å¤åˆ¶åˆ°å®˜ç½‘ downloads ç›®å½•
cp /path/to/CursorX-1.0.0.dmg /Users/ymg/gitee/xcursor/xpoint/CursorX-portal/downloads/
```

### ç¬¬äºŒæ­¥ï¼šç”Ÿæˆå¹¶é…ç½®ç­¾å

#### 2.1 ç”Ÿæˆ EdDSA å¯†é’¥å¯¹

Sparkle 2.0+ ä½¿ç”¨ EdDSA ç­¾åã€‚æœ‰ä¸¤ç§æ–¹æ³•ï¼š

**æ–¹æ³•1ï¼šä½¿ç”¨ Sparkle å·¥å…·ï¼ˆæ¨èï¼‰**

```bash
# å¦‚æœå·²å®‰è£… Sparkle
cd /Users/ymg/gitee/xcursor/xpoint
./generate_sparkle_keys.sh

# æˆ–è€…æ‰‹åŠ¨ä¸‹è½½ Sparkle
# 1. è®¿é—® https://github.com/sparkle-project/Sparkle/releases
# 2. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
# 3. è§£å‹åè¿è¡Œï¼š
./bin/generate_keys
```

**æ–¹æ³•2ï¼šä½¿ç”¨ OpenSSLï¼ˆå¤‡é€‰ï¼‰**

```bash
# ç”Ÿæˆ EdDSA å¯†é’¥å¯¹
openssl genpkey -algorithm ed25519 -out eddsa_private_key.pem
openssl pkey -in eddsa_private_key.pem -pubout -out eddsa_public_key.pem

# æå–å…¬é’¥ï¼ˆbase64 æ ¼å¼ï¼‰
openssl pkey -in eddsa_public_key.pem -pubin -outform DER | base64
```

#### 2.2 é…ç½®å…¬é’¥

**åœ¨ appcast.xml ä¸­æ·»åŠ å…¬é’¥ï¼š**

```xml
<rss version="2.0" xmlns:sparkle="http://www.andymatuschak.org/xml-namespaces/sparkle">
    <channel>
        <title>CursorX æ›´æ–°</title>
        <!-- åœ¨è¿™é‡Œæ·»åŠ å…¬é’¥ -->
        <sparkle:publicKey>YOUR_BASE64_PUBLIC_KEY_HERE</sparkle:publicKey>
        
        <!-- å…¶ä»–å†…å®¹... -->
    </channel>
</rss>
```

**åœ¨åº”ç”¨çš„ Info.plist ä¸­é…ç½®å…¬é’¥ï¼š**

```xml
<key>SUPublicEDKey</key>
<string>YOUR_BASE64_PUBLIC_KEY_HERE</string>
```

#### 2.3 ç­¾å .dmg æ–‡ä»¶

```bash
# ä½¿ç”¨ Sparkle å·¥å…·ç­¾å
./bin/sign_update /Users/ymg/gitee/xcursor/xpoint/CursorX-portal/downloads/CursorX-1.0.0.dmg eddsa_private_key.pem

# è¾“å‡ºç¤ºä¾‹ï¼š
# sparkle:edSignature="MC0CFQCdoW13VBGJWoj..."

# å°†ç­¾åæ·»åŠ åˆ° appcast.xml çš„å¯¹åº”ç‰ˆæœ¬ä¸­
```

#### 2.4 æ›´æ–° appcast.xml

```xml
<enclosure url="https://cursorx.app/downloads/CursorX-1.0.0.dmg"
           sparkle:version="1.0.0"
           sparkle:shortVersionString="1.0.0"
           length="13107200"
           type="application/octet-stream"
           sparkle:edSignature="MC0CFQCdoW13VBGJWoj..."/>  <!-- æ›¿æ¢ä¸ºå®é™…ç­¾å -->
```

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²åˆ° GitHub Pages

#### 3.1 æäº¤æ›´æ”¹

```bash
cd /Users/ymg/gitee/xcursor/xpoint/CursorX-portal

# æ·»åŠ æ–‡ä»¶
git add appcast.xml
git add downloads/CursorX-1.0.0.dmg
git add downloads/README.md

# æäº¤
git commit -m "æ·»åŠ  CursorX v1.0.0 æ›´æ–°åŒ…å’Œ appcast.xml"

# æ¨é€åˆ° GitHub
git push origin main  # æˆ– masterï¼Œå–å†³äºæ‚¨çš„ä¸»åˆ†æ”¯åç§°
```

#### 3.2 éªŒè¯éƒ¨ç½²

ç­‰å¾… GitHub Pages éƒ¨ç½²å®Œæˆï¼ˆé€šå¸¸ 1-2 åˆ†é’Ÿï¼‰ï¼Œç„¶åéªŒè¯ï¼š

```bash
# æ£€æŸ¥ appcast.xml æ˜¯å¦å¯è®¿é—®
curl https://cursorx.app/appcast.xml

# æ£€æŸ¥ä¸‹è½½æ–‡ä»¶æ˜¯å¦å¯è®¿é—®
curl -I https://cursorx.app/downloads/CursorX-1.0.0.dmg
```

### ç¬¬å››æ­¥ï¼šæµ‹è¯•æ›´æ–°åŠŸèƒ½

#### 4.1 æœ¬åœ°æµ‹è¯•

```bash
# å¯åŠ¨åº”ç”¨
open /path/to/xpoint.app

# ç‚¹å‡»çŠ¶æ€æ  â†’ æ£€æŸ¥æ›´æ–°
# åº”è¯¥èƒ½çœ‹åˆ°æ›´æ–°æ£€æŸ¥è¿‡ç¨‹
```

#### 4.2 å¼ºåˆ¶æµ‹è¯•æ›´æ–°

**æ–¹æ³•1ï¼šä¸´æ—¶é™ä½ç‰ˆæœ¬å·**

åœ¨ `Info.plist` ä¸­ï¼š
```xml
<key>CFBundleShortVersionString</key>
<string>0.9.0</string>  <!-- ä¸´æ—¶æ”¹ä¸ºä½äº 1.0.0 çš„ç‰ˆæœ¬ -->
```

**æ–¹æ³•2ï¼šæ¸…é™¤ Sparkle ç¼“å­˜**

```bash
# åˆ é™¤ Sparkle ç¼“å­˜
defaults delete com.ymg.xpoint SULastCheckTime
defaults delete com.ymg.xpoint SUSkippedVersion

# é‡å¯åº”ç”¨
killall xpoint
open /path/to/xpoint.app
```

## ğŸ”§ ç®€åŒ–æ–¹æ¡ˆï¼ˆæ— ç­¾åæµ‹è¯•ï¼‰

å¦‚æœæ‚¨æƒ³å…ˆæµ‹è¯•æ›´æ–°æµç¨‹ï¼Œå¯ä»¥æš‚æ—¶è·³è¿‡ç­¾åï¼š

### 1. ä¿®æ”¹ appcast.xml

```xml
<!-- ç§»é™¤ sparkle:edSignature å±æ€§ -->
<enclosure url="https://cursorx.app/downloads/CursorX-1.0.0.dmg"
           sparkle:version="1.0.0"
           sparkle:shortVersionString="1.0.0"
           length="13107200"
           type="application/octet-stream"/>
```

### 2. ä¿®æ”¹ Info.plist

```xml
<!-- ç§»é™¤æˆ–æ³¨é‡Šæ‰å…¬é’¥é…ç½® -->
<!-- <key>SUPublicEDKey</key> -->
<!-- <string>WILL_BE_GENERATED</string> -->
```

### 3. ç¦ç”¨ç­¾åéªŒè¯ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰

åœ¨ `UpdateManager.swift` çš„ `setupSparkle()` ä¸­æ·»åŠ ï¼š

```swift
// âš ï¸ ä»…ç”¨äºæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ç§»é™¤
updater.sendsSystemProfile = false
```

**âš ï¸ æ³¨æ„ï¼š** è¿™ç§æ–¹å¼ä»…ç”¨äºæµ‹è¯•ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®ç­¾åï¼

## ğŸ“¦ è‡ªåŠ¨åŒ–è„šæœ¬

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œè®©éƒ¨ç½²æ›´ç®€å•ï¼š

### ä½¿ç”¨æ–¹æ³•ï¼š

```bash
# 1. åˆ›å»º DMG
cd /Users/ymg/gitee/xcursor/xpoint
./create_dmg.sh

# 2. éƒ¨ç½²åˆ°å®˜ç½‘
cd CursorX-portal
./deploy_update.sh 1.0.0
```

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [ ] âœ… appcast.xml æ–‡ä»¶å·²åˆ›å»º
- [ ] âœ… downloads/ ç›®å½•å·²åˆ›å»º
- [ ] â³ .dmg æ–‡ä»¶å·²å‡†å¤‡å¥½
- [ ] â³ EdDSA å¯†é’¥å·²ç”Ÿæˆ
- [ ] â³ å…¬é’¥å·²é…ç½®åˆ° appcast.xml
- [ ] â³ å…¬é’¥å·²é…ç½®åˆ° Info.plist
- [ ] â³ .dmg æ–‡ä»¶å·²ç­¾å
- [ ] â³ ç­¾åå·²æ·»åŠ åˆ° appcast.xml
- [ ] â³ æ–‡ä»¶å·²ä¸Šä¼ åˆ° GitHub
- [ ] â³ GitHub Pages å·²éƒ¨ç½²
- [ ] â³ URL å¯è®¿é—®æ€§å·²éªŒè¯
- [ ] â³ æ›´æ–°åŠŸèƒ½å·²æµ‹è¯•

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è·å– .dmg æ–‡ä»¶å¤§å°ï¼Ÿ

```bash
ls -l /path/to/CursorX-1.0.0.dmg | awk '{print $5}'
```

### Q2: å¦‚ä½•éªŒè¯ç­¾åæ˜¯å¦æ­£ç¡®ï¼Ÿ

```bash
# ä½¿ç”¨ Sparkle å·¥å…·éªŒè¯
./bin/verify_signature /path/to/CursorX-1.0.0.dmg eddsa_public_key.pem SIGNATURE
```

### Q3: GitHub Pages éƒ¨ç½²åå¤šä¹…ç”Ÿæ•ˆï¼Ÿ

é€šå¸¸ 1-2 åˆ†é’Ÿï¼Œå¯ä»¥åœ¨ä»“åº“çš„ Actions æ ‡ç­¾æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ã€‚

### Q4: å¦‚ä½•è°ƒè¯•æ›´æ–°æ£€æŸ¥å¤±è´¥ï¼Ÿ

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
log stream --predicate 'process == "xpoint"' --level debug | grep Update

# æŸ¥çœ‹ Sparkle æ—¥å¿—
defaults read com.ymg.xpoint
```

## ğŸ“ ä¸‹ä¸€æ­¥

å®Œæˆå®˜ç½‘éƒ¨ç½²åï¼Œæ‚¨å¯ä»¥ï¼š

1. æµ‹è¯•å®Œæ•´çš„æ›´æ–°æµç¨‹
2. é…ç½®è‡ªåŠ¨æ›´æ–°ç­–ç•¥
3. æ·»åŠ æ›´æ–°é€šçŸ¥
4. ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

**é‡è¦æé†’ï¼š**
- ç§é’¥æ–‡ä»¶ï¼ˆ`eddsa_private_key.pem`ï¼‰è¯·å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æäº¤åˆ° Git
- å»ºè®®å°†ç§é’¥å¤‡ä»½åˆ°å®‰å…¨çš„åœ°æ–¹
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®ç­¾åéªŒè¯
