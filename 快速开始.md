# CursorX 官网更新 - 快速开始

## 🎯 最简单的部署方式（3步完成）

### 第1步：创建 DMG 安装包

```bash
cd /Users/ymg/gitee/xcursor/xpoint
./create_dmg.sh
```

这会自动：
- ✅ 从 Xcode 编译目录复制应用
- ✅ 创建 DMG 安装包
- ✅ 保存到 `CursorX-portal/downloads/` 目录
- ✅ 显示文件大小信息

### 第2步：更新 appcast.xml

打开 `CursorX-portal/appcast.xml`，找到对应版本，更新文件大小：

```xml
<enclosure url="https://cursorx.app/downloads/CursorX-1.0.0.dmg"
           sparkle:version="1.0.0"
           sparkle:shortVersionString="1.0.0"
           length="13107200"  <!-- 替换为实际文件大小 -->
           type="application/octet-stream"
           sparkle:edSignature="[待生成签名]"/>  <!-- 暂时保持这样 -->
```

💡 **提示：** `create_dmg.sh` 会显示文件大小，直接复制即可。

### 第3步：部署到 GitHub

```bash
cd /Users/ymg/gitee/xcursor/xpoint/CursorX-portal
./deploy_update.sh 1.0.0
```

这会自动：
- ✅ 添加文件到 Git
- ✅ 提交更改
- ✅ 推送到 GitHub
- ✅ 触发 GitHub Pages 部署

## ✅ 完成！

等待 1-2 分钟后，您的更新就会生效。

## 🧪 测试更新

### 方法1：临时降低版本号测试

1. 打开 `xpoint/Info.plist`
2. 修改版本号：
   ```xml
   <key>CFBundleShortVersionString</key>
   <string>0.9.0</string>  <!-- 改为低于 1.0.0 -->
   ```
3. 重新编译并运行应用
4. 点击状态栏 → 检查更新
5. 应该能看到 v1.0.0 的更新提示

### 方法2：清除缓存测试

```bash
# 清除 Sparkle 缓存
defaults delete com.ymg.xpoint SULastCheckTime
defaults delete com.ymg.xpoint SUSkippedVersion

# 重启应用
killall xpoint
open /path/to/xpoint.app

# 点击检查更新
```

## ⚠️ 关于签名

目前 appcast.xml 中的签名是 `[待生成签名]`，这意味着：

- ✅ **可以检测到更新** - Sparkle 会发现新版本
- ❌ **无法下载安装** - 签名验证会失败

### 要启用完整功能，需要配置签名：

1. **生成密钥：**
   ```bash
   cd /Users/ymg/gitee/xcursor/xpoint
   ./generate_sparkle_keys.sh
   ```

2. **签名 DMG：**
   ```bash
   ./bin/sign_update CursorX-portal/downloads/CursorX-1.0.0.dmg eddsa_private_key.pem
   ```

3. **更新 appcast.xml：**
   将生成的签名替换 `[待生成签名]`

4. **重新部署：**
   ```bash
   cd CursorX-portal
   ./deploy_update.sh 1.0.0
   ```

## 📋 当前可以做什么

即使没有配置签名，您现在也可以：

✅ **测试更新检查功能**
- 应用能检测到新版本
- 状态栏显示更新通知
- 可以查看更新详情

✅ **验证部署流程**
- appcast.xml 正确解析
- 版本号正确识别
- 更新内容正确显示

❌ **暂时无法做的**
- 下载更新包
- 自动安装更新

## 🎯 推荐流程

### 阶段1：测试基础功能（现在）
1. 创建 DMG
2. 更新 appcast.xml
3. 部署到 GitHub
4. 测试更新检测

### 阶段2：配置签名（后续）
1. 生成签名密钥
2. 签名 DMG 文件
3. 更新 appcast.xml
4. 测试完整流程

## 🆘 常见问题

### Q: 如何查看文件大小？
```bash
ls -l CursorX-portal/downloads/CursorX-1.0.0.dmg | awk '{print $5}'
```

### Q: 如何验证 appcast.xml 格式？
```bash
curl https://cursorx.app/appcast.xml
# 或者在浏览器中打开
```

### Q: GitHub Pages 部署需要多久？
通常 1-2 分钟，可以在仓库的 Actions 标签查看进度。

### Q: 如何查看应用日志？
```bash
log stream --predicate 'process == "xpoint"' --level debug | grep Update
```

## 📞 下一步

完成基础部署后，建议：
1. 阅读 `官网部署指南.md` 了解详细配置
2. 配置签名以启用完整功能
3. 优化更新体验和通知

---

**快速命令参考：**

```bash
# 创建 DMG
./create_dmg.sh

# 部署更新
cd CursorX-portal && ./deploy_update.sh 1.0.0

# 测试更新
defaults delete com.ymg.xpoint SULastCheckTime && killall xpoint
```
